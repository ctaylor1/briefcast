version: "2.1"
services:
  briefcast:
    build:
      context: .
      args:
        - TORCH_INDEX_URL=https://download.pytorch.org/whl/cpu
        - TORCH_VERSION=2.8.0
        - TORCH_BUILD=+cpu
    image: ctaylor1/briefcast
    container_name: briefcast
    environment:
      - CHECK_FREQUENCY=240
      - DATABASE_URL=sqlite:///config/briefcast.db
      - WHISPERX_ENABLED=true
      - WHISPERX_DIARIZATION=false
      - WHISPERX_CHECK_FREQUENCY=10
      # For postgres use:
      # - DATABASE_URL=postgres://briefcast:briefcast@postgres:5432/briefcast?sslmode=disable
      # - DB_DRIVER=postgres
    volumes:
      - C:/DevRepo/Projects/briefcast/config:/config
      - C:/DevRepo/Projects/briefcast/data:/assets
    ports:
      - 8080:8080
    restart: unless-stopped

  postgres:
    image: postgres:17-alpine
    profiles: ["postgres"]
    environment:
      - POSTGRES_USER=briefcast
      - POSTGRES_PASSWORD=briefcast
      - POSTGRES_DB=briefcast
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

volumes:
  postgres_data:
